<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Panel de moderación del Foro Académico UPA. Gestiona reportes, usuarios y contenido de la comunidad.">
    <meta name="robots" content="noindex, nofollow">
    <title>Panel de Moderación - Foro Académico UPA</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/FORO%20WEB%20ACAD%C3%89MICO/frontend/css/styles.css">

    <style>
        .reporte-item {
            transition: all 0.2s ease;
            border-left: 4px solid transparent;
        }

        .reporte-item:hover {
            background-color: #f8f9fa;
        }

        .severity-high { border-left-color: #dc3545 !important; }
        .severity-medium { border-left-color: #ffc107 !important; }
        .severity-low { border-left-color: #0dcaf0 !important; }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-upa-primary sticky-top shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="#" data-route="foro">
                <i class="fas fa-graduation-cap fa-2x me-2"></i>
                <span class="fw-bold d-none d-md-inline">Foro Académico UPA</span>
            </a>
            <div class="d-flex align-items-center ms-auto">
                <span class="badge bg-danger me-3" id="navbarReportesPendientes">
                    <i class="fas fa-flag me-1"></i> 0 reportes
                </span>
                <div class="dropdown">
                    <button class="btn btn-link text-white d-flex align-items-center" data-bs-toggle="dropdown">
                        <img src="https://ui-avatars.com/api/?name=Moderador&background=0d6efd&color=fff"
                             class="rounded-circle me-2" width="35" height="35" id="navbarAvatar">
                        <span class="d-none d-md-inline" id="navbarNombre">Moderador</span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li class="dropdown-header">
                            <span class="badge bg-primary" id="navbarRol">Moderador</span>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" data-route="foro"><i class="fas fa-fire me-2"></i> Foro</a></li>
                        <li><a class="dropdown-item" href="#" data-route="dashboard"><i class="fas fa-home me-2"></i> Dashboard</a></li>
                        <li><a class="dropdown-item" href="#" data-route="perfil"><i class="fas fa-user me-2"></i> Mi Perfil</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-danger" href="#" data-action="logout">
                            <i class="fas fa-sign-out-alt me-2"></i> Cerrar Sesión
                        </a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid py-4">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="#" data-route="foro">Inicio</a></li>
                <li class="breadcrumb-item active">Panel de Moderación</li>
            </ol>
        </nav>

        <!-- Header -->
        <div class="d-flex flex-wrap gap-2 justify-content-between align-items-center mb-4">
            <h2 class="fw-bold mb-0">
                <i class="fas fa-shield-alt me-2"></i> Panel de Moderación
            </h2>
            <div class="btn-group">
                <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#estadisticasModal">
                    <i class="fas fa-chart-bar me-2"></i> Estadísticas
                </button>
                <button class="btn btn-outline-secondary" id="exportarLogBtn">
                    <i class="fas fa-download me-2"></i> Exportar Log
                </button>
            </div>
        </div>

        <!-- Estadísticas Rápidas -->
        <div class="row g-3 mb-4" id="moderacionStats">
            <div class="col-md-3">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <p class="text-muted mb-1 small">Reportes Pendientes</p>
                                <h3 class="mb-0 fw-bold text-danger" id="statReportesPendientes">0</h3>
                            </div>
                            <div class="bg-danger bg-opacity-10 p-3 rounded">
                                <i class="fas fa-flag fa-2x text-danger"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <p class="text-muted mb-1 small">Resueltos Hoy</p>
                                <h3 class="mb-0 fw-bold text-success" id="statResueltosHoy">0</h3>
                            </div>
                            <div class="bg-success bg-opacity-10 p-3 rounded">
                                <i class="fas fa-check fa-2x text-success"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <p class="text-muted mb-1 small">Contenido Eliminado</p>
                                <h3 class="mb-0 fw-bold text-warning" id="statContenidoEliminado">0</h3>
                            </div>
                            <div class="bg-warning bg-opacity-10 p-3 rounded">
                                <i class="fas fa-trash fa-2x text-warning"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <p class="text-muted mb-1 small">Advertencias Enviadas</p>
                                <h3 class="mb-0 fw-bold text-info" id="statAdvertencias">0</h3>
                            </div>
                            <div class="bg-info bg-opacity-10 p-3 rounded">
                                <i class="fas fa-exclamation-triangle fa-2x text-info"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Reportes Pendientes -->
            <div class="col-lg-8">
                <!-- Filtros -->
                <div class="card border-0 shadow-sm mb-3">
                    <div class="card-body">
                        <div class="row g-2 align-items-center">
                            <div class="col-md-4">
                                <label class="form-label small text-muted mb-1" for="filtroPrioridad">Prioridad</label>
                                <select class="form-select" id="filtroPrioridad">
                                    <option value="">Todas las prioridades</option>
                                    <option value="alta">Alta prioridad</option>
                                    <option value="media">Media prioridad</option>
                                    <option value="baja">Baja prioridad</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label small text-muted mb-1" for="filtroMateria">Materia</label>
                                <select class="form-select" id="filtroMateria">
                                    <option value="">Todas las materias</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label small text-muted mb-1" for="filtroTipo">Tipo de reporte</label>
                                <select class="form-select" id="filtroTipo">
                                    <option value="">Todos los tipos</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lista de Reportes -->
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 fw-bold">
                            <i class="fas fa-flag me-2"></i> Cola de Reportes
                        </h5>
                        <span class="badge bg-light text-muted" id="totalReportes">0</span>
                    </div>
                    <div class="card-body p-0" id="listaReportes">
                        <div class="p-4 text-center text-muted">
                            <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                            <p>Cargando reportes...</p>
                        </div>
                    </div>
                    <div class="card-footer bg-white text-center">
                        <button class="btn btn-outline-secondary w-100" id="loadMoreReportesBtn" type="button">
                            <span class="btn-text">Cargar más reportes</span>
                            <span class="btn-loading d-none"><i class="fas fa-spinner fa-spin me-2"></i>Cargando...</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="col-lg-4">
                <!-- Acciones Rápidas -->
                <div class="card border-0 shadow-sm mb-3">
                    <div class="card-header bg-white">
                        <h6 class="mb-0 fw-bold">
                            <i class="fas fa-bolt me-2"></i> Acciones Rápidas
                        </h6>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-outline-primary w-100 mb-2" id="buscarUsuarioBtn">
                            <i class="fas fa-search me-2"></i> Buscar Usuario
                        </button>
                        <button class="btn btn-outline-warning w-100 mb-2" id="bloquearUsuarioBtn">
                            <i class="fas fa-ban me-2"></i> Bloquear Usuario
                        </button>
                        <button class="btn btn-outline-success w-100" id="crearAvisoBtn">
                            <i class="fas fa-plus me-2"></i> Crear Aviso
                        </button>
                    </div>
                </div>

                <!-- Usuarios Bloqueados -->
                <div class="card border-0 shadow-sm mb-3">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h6 class="mb-0 fw-bold">
                            <i class="fas fa-user-lock me-2"></i> Usuarios Bloqueados
                        </h6>
                        <button class="btn btn-sm btn-outline-secondary" id="refreshUsuariosBloqueadosBtn" type="button" title="Actualizar lista de bloqueados">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                    <div class="card-body" id="usuariosBloqueados">
                        <div class="text-center py-4 text-muted">
                            <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                            <p>Cargando usuarios bloqueados...</p>
                        </div>
                    </div>
                </div>

                <!-- Actividad Reciente -->
                <div class="card border-0 shadow-sm mb-3">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h6 class="mb-0 fw-bold">
                            <i class="fas fa-history me-2"></i> Actividad Reciente
                        </h6>
                        <button class="btn btn-sm btn-outline-secondary" id="limpiarActividadBtn" type="button" title="Limpiar actividad">
                            <i class="fas fa-eraser"></i>
                        </button>
                    </div>
                    <div class="card-body" id="actividadModeracion">
                        <div class="text-center py-4 text-muted">
                            <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                            <p>Cargando actividad...</p>
                        </div>
                    </div>
                </div>

                <!-- Alertas -->
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white">
                        <h6 class="mb-0 fw-bold">
                            <i class="fas fa-user-slash me-2"></i> Alertas
                        </h6>
                    </div>
                    <div class="card-body" id="alertasModeracion">
                        <div class="text-center py-4 text-muted">
                            <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                            <p>Analizando alertas...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Detalle de Reporte -->
    <div class="modal fade" id="detalleReporteModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold">Detalle del reporte</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <span class="badge bg-secondary" id="detallePrioridad">Prioridad</span>
                        <span class="badge bg-info ms-1" id="detalleTipo">Tipo</span>
                        <span class="badge bg-light text-muted ms-1" id="detalleEstado">Estado</span>
                    </div>
                    <h5 id="detalleTitulo">-</h5>
                    <p class="text-muted" id="detalleDescripcion">-</p>
                    <div class="bg-light border rounded p-3 mb-3">
                        <strong>Contenido reportado:</strong>
                        <p class="mb-0 mt-2" id="detalleContenido">-</p>
                    </div>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <h6 class="fw-bold">Datos del autor</h6>
                            <p class="mb-1"><i class="fas fa-user me-2"></i> <span id="detalleAutor">-</span></p>
                            <p class="mb-1"><i class="fas fa-book me-2"></i> <span id="detalleMateria">-</span></p>
                            <p class="mb-1"><i class="fas fa-clock me-2"></i> <span id="detalleFecha">-</span></p>
                        </div>
                        <div class="col-md-6">
                            <h6 class="fw-bold">Reportantes</h6>
                            <div id="detalleReportantes" class="small text-muted">-</div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer d-flex justify-content-between">
                    <div id="detalleNotas" class="text-start small text-muted"></div>
                    <div class="btn-group">
                        <button class="btn btn-outline-warning" id="detalleAdvertirBtn">
                            <i class="fas fa-exclamation-triangle me-1"></i> Advertir
                        </button>
                        <button class="btn btn-outline-danger" id="detalleEliminarBtn">
                            <i class="fas fa-trash me-1"></i> Eliminar
                        </button>
                        <button class="btn btn-outline-success" id="detalleAprobarBtn">
                            <i class="fas fa-check me-1"></i> Aprobar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Acción de Moderación -->
    <div class="modal fade" id="accionReporteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold" id="accionModalTitulo">Confirmar acción</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="accionReporteForm">
                    <div class="modal-body">
                        <input type="hidden" id="accionReporteId">
                        <input type="hidden" id="accionTipo">
                        <div class="mb-3" id="accionMotivoGroup">
                            <label class="form-label">Motivo / Comentario</label>
                            <textarea class="form-control" id="accionMotivo" rows="3" placeholder="Describe la razón de la acción" required></textarea>
                            <div class="form-text">Este mensaje puede ser enviado al autor o registrado en el sistema.</div>
                        </div>
                        <p class="mb-0 text-muted" id="accionResumen">¿Deseas continuar?</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-upa-primary" id="accionSubmitBtn">Confirmar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Buscar Usuario -->
    <div class="modal fade" id="buscarUsuarioModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold">Buscar usuario</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form class="mb-3" id="buscarUsuarioForm">
                        <div class="input-group">
                            <input type="text" class="form-control" id="buscarUsuarioInput" placeholder="Nombre, matrícula o correo" required>
                            <button class="btn btn-upa-primary" type="submit">
                                <i class="fas fa-search me-1"></i> Buscar
                            </button>
                        </div>
                    </form>
                    <div id="buscarUsuarioResultados" class="list-group">
                        <div class="text-center py-4 text-muted">
                            <i class="fas fa-users fa-2x mb-3"></i>
                            <p>Ingresa un término de búsqueda para encontrar usuarios.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Estadísticas -->
    <div class="modal fade" id="estadisticasModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold">Estadísticas de Moderación</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="estadisticasContenido">
                    <div class="text-center py-4 text-muted">
                        <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                        <p>Obteniendo estadísticas...</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Crear Aviso -->
    <div class="modal fade" id="crearAvisoModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold"><i class="fas fa-bullhorn me-2"></i> Crear aviso</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="crearAvisoForm">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Título</label>
                            <input type="text" class="form-control" id="avisoTitulo" maxlength="255" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Mensaje</label>
                            <textarea class="form-control" id="avisoMensaje" rows="4" maxlength="1000" required></textarea>
                            <div class="form-text">Este mensaje se enviará a los usuarios seleccionados como notificación.</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Enlace opcional</label>
                            <input type="url" class="form-control" id="avisoEnlace" placeholder="https://">
                        </div>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label">Destino</label>
                                <select class="form-select" id="avisoDestino">
                                    <option value="todos">Todos los usuarios</option>
                                    <option value="carrera">Por carrera</option>
                                    <option value="rol">Por rol</option>
                                    <option value="usuario">Usuario específico</option>
                                </select>
                            </div>
                            <div class="col-md-8 d-none" id="avisoCarreraGroup">
                                <label class="form-label">Carrera</label>
                                <select class="form-select" id="avisoCarrera">
                                    <option value="">Selecciona una carrera</option>
                                </select>
                            </div>
                            <div class="col-md-8 d-none" id="avisoRolGroup">
                                <label class="form-label">Rol</label>
                                <select class="form-select" id="avisoRol">
                                    <option value="">Selecciona un rol</option>
                                    <option value="estudiante">Estudiantes</option>
                                    <option value="profesor">Profesores</option>
                                    <option value="admin">Administradores</option>
                                </select>
                            </div>
                            <div class="col-md-8 d-none" id="avisoUsuarioGroup">
                                <label class="form-label">Correo institucional o ID</label>
                                <input type="text" class="form-control" id="avisoUsuario" placeholder="correo@upatlacomulco.edu.mx">
                                <div class="form-text">Ingresa el correo institucional o el ID del usuario destino.</div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-upa-primary" id="avisoSubmitBtn">
                            <i class="fas fa-paper-plane me-2"></i> Enviar aviso
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Suspender Usuario -->
    <div class="modal fade" id="suspensionModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold"><i class="fas fa-user-slash me-2"></i> Suspender usuario</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="suspensionForm">
                    <div class="modal-body">
                        <p class="mb-3">
                            Estás por suspender al usuario <strong id="suspensionUsuarioLabel">-</strong>. Define el motivo y, si lo necesitas, la duración de la suspensión.
                        </p>
                        <div class="mb-3">
                            <label class="form-label">Motivo</label>
                            <textarea class="form-control" id="suspensionMotivo" rows="3" maxlength="500" required></textarea>
                        </div>
                        <div class="row g-3 align-items-end">
                            <div class="col-md-6">
                                <label class="form-label">Duración</label>
                                <input type="number" class="form-control" id="suspensionDuracion" min="1" placeholder="Ej. 7">
                                <div class="form-text">Deja vacío para bloquear indefinidamente.</div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Unidad</label>
                                <select class="form-select" id="suspensionUnidad">
                                    <option value="dias">Días</option>
                                    <option value="semanas">Semanas</option>
                                    <option value="meses">Meses</option>
                                    <option value="horas">Horas</option>
                                    <option value="minutos">Minutos</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-outline-danger" id="suspensionSubmitBtn">
                            <i class="fas fa-ban me-2"></i> Suspender usuario
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Advertencia Usuario -->
    <div class="modal fade" id="advertenciaModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold"><i class="fas fa-exclamation-triangle me-2"></i> Enviar advertencia</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="advertirUsuarioForm">
                    <div class="modal-body">
                        <p class="mb-3">
                            La advertencia se enviará a <strong id="advertenciaUsuarioLabel">-</strong>. Explica brevemente la razón.
                        </p>
                        <div class="mb-3">
                            <label class="form-label">Mensaje</label>
                            <textarea class="form-control" id="advertenciaMensaje" rows="4" maxlength="1000" required></textarea>
                            <div class="form-text">Este mensaje llegará como notificación al usuario.</div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-outline-warning" id="advertenciaSubmitBtn">
                            <i class="fas fa-paper-plane me-2"></i> Enviar advertencia
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/FORO%20WEB%20ACAD%C3%89MICO/frontend/js/api.js"></script>
    <script src="/FORO%20WEB%20ACAD%C3%89MICO/frontend/js/auth.js"></script>
    <script src="/FORO%20WEB%20ACAD%C3%89MICO/frontend/js/main.js"></script>
    <script src="/FORO%20WEB%20ACAD%C3%89MICO/frontend/js/moderacion.js"></script>
</body>
</html>